"use strict";(self.webpackChunkstencil=self.webpackChunkstencil||[]).push([[383],{3905:function(e,t,a){a.d(t,{Zo:function(){return m},kt:function(){return d}});var n=a(7294);function s(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){s(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function c(e,t){if(null==e)return{};var a,n,s=function(e,t){if(null==e)return{};var a,n,s={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(s[a]=e[a]);return s}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(s[a]=e[a])}return s}var i=n.createContext({}),l=function(e){var t=n.useContext(i),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},m=function(e){var t=l(e.components);return n.createElement(i.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,s=e.mdxType,r=e.originalType,i=e.parentName,m=c(e,["components","mdxType","originalType","parentName"]),u=l(a),d=s,h=u["".concat(i,".").concat(d)]||u[d]||p[d]||r;return a?n.createElement(h,o(o({ref:t},m),{},{components:a})):n.createElement(h,o({ref:t},m))}));function d(e,t){var a=arguments,s=t&&t.mdxType;if("string"==typeof e||s){var r=a.length,o=new Array(r);o[0]=u;var c={};for(var i in t)hasOwnProperty.call(t,i)&&(c[i]=t[i]);c.originalType=e,c.mdxType="string"==typeof e?e:s,o[1]=c;for(var l=2;l<r;l++)o[l]=a[l];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},6212:function(e,t,a){a.r(t),a.d(t,{assets:function(){return m},contentTitle:function(){return i},default:function(){return d},frontMatter:function(){return c},metadata:function(){return l},toc:function(){return p}});var n=a(7462),s=a(3366),r=(a(7294),a(3905)),o=["components"],c={},i="Manage schemas",l={unversionedId:"guides/manage_schemas",id:"guides/manage_schemas",title:"Manage schemas",description:"Create a schema",source:"@site/docs/guides/3_manage_schemas.md",sourceDirName:"guides",slug:"/guides/manage_schemas",permalink:"/stencil/docs/guides/manage_schemas",editUrl:"https://github.com/goto/stencil/edit/master/docs/docs/guides/3_manage_schemas.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{},sidebar:"docsSidebar",previous:{title:"Manage namespaces",permalink:"/stencil/docs/guides/manage_namespace"},next:{title:"Using clients",permalink:"/stencil/docs/guides/clients"}},m={},p=[{value:"Create a schema",id:"create-a-schema",level:2},{value:"List schema",id:"list-schema",level:2},{value:"View schema",id:"view-schema",level:2},{value:"Update schema",id:"update-schema",level:2},{value:"List versions",id:"list-versions",level:2}],u={toc:p};function d(e){var t=e.components,a=(0,s.Z)(e,o);return(0,r.kt)("wrapper",(0,n.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"manage-schemas"},"Manage schemas"),(0,r.kt)("h2",{id:"create-a-schema"},"Create a schema"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'# create namespace named "quickstart" with backward compatibility enabled\ncurl -X POST http://localhost:8000/v1beta1/namespaces -H \'Content-Type: application/json\' -d \'{"id": "quickstart", "format": "FORMAT_PROTOBUF", "compatibility": "COMPATIBILITY_BACKWARD", "description": "This field can be used to store namespace description"}\'\n\n# list namespaces\ncurl http://localhost:8000/v1beta1/namespaces\n\n# upload generated proto descriptor file to server with schema name as `example` under `quickstart` namespace.\ncurl -X POST http://localhost:8000/v1beta1/namespaces/quickstart/schemas/example --data-binary "@file.desc"\n')),(0,r.kt)("h2",{id:"list-schema"},"List schema"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# get list of schemas available in a namespace\ncurl -X GET http://localhost:8000/v1beta1/namespaces/quickstart/schemas\n")),(0,r.kt)("h2",{id:"view-schema"},"View schema"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# get list of versions available for particular schema. These versions are auto generated. Version numbers managed by stencil.\ncurl -X GET http://localhost:8000/v1beta1/namespaces/quickstart/schemas/example/versions\n\n# download specific version of particular schema\ncurl -X GET http://localhost:8000/v1beta1/namespaces/quickstart/schemas/example/versions/1\n\n# download latest version of particular schema\ncurl -X GET http://localhost:8000/v1beta1/namespaces/quickstart/schemas/example;\n")),(0,r.kt)("h2",{id:"update-schema"},"Update schema"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'# now let\'s try uploading breaking proto definition. Note that proto field number has changed from 1 to 2.\necho "syntax=\\"proto3\\";\\npackage stencil;\\nmessage One {\\n  int32 field_one = 2;\\n}" > one.proto;\n\n# create descriptor file\nprotoc --descriptor_set_out=./file.desc --include_imports ./**/*.proto;\n\n# now try to upload this descriptor file with same name as before. This call should fail, giving you reason it has failed.\ncurl -H "X-SourceURL:www.github.com/some-repo" -H "X-CommitSHA:some-commit-sha" -X POST http://localhost:8000/v1/namespaces/quickstart/schemas --data-binary "@file.desc";\n\n# now let\'s try fixing our proto add a new field without having any breaking changes.\necho "syntax=\\"proto3\\";\\npackage stencil;\\nmessage One {\\n  int32 field_one = 1;\\nint32 field_two = 2;\\n}" > one.proto;\n\n# create descriptor file\nprotoc --descriptor_set_out=./file.desc --include_imports ./**/*.proto\n\n# now try to upload this descriptor file with same name as before. This call should succeed\ncurl -H "X-SourceURL:www.github.com/some-repo" -H "X-CommitSHA:some-commit-sha" -X POST http://localhost:8000/v1/namespaces/quickstart/schemas --data-binary "@file.desc"\n')),(0,r.kt)("h2",{id:"list-versions"},"List versions"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'\n# now try versions api. It should have 2 versions now.\ncurl -X GET http://localhost:8000/v1beta1/namespaces/quickstart/schemas/example/versions\n\n# upload schema can be called multiple times. Stencil server will retain old version if it\'s already uploaded. This call won\'t create new version again. You can verify by using versions API again.\ncurl -H "X-SourceURL:www.github.com/some-repo" -H "X-CommitSHA:some-commit-sha" -X POST http://localhost:8000/v1/namespaces/quickstart/schemas --data-binary "@file.desc"\n')))}d.isMDXComponent=!0}}]);